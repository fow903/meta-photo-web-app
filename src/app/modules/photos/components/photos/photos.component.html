<div class="photos-container">
  <div class="table-wrapper">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef class="sticky-header"> ID </th>
        <td mat-cell *matCellDef="let photo"> {{ photo.id }} </td>
      </ng-container>

      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef class="sticky-header"> Title </th>
        <td mat-cell *matCellDef="let photo"> {{ photo.title }} </td>
      </ng-container>

      <ng-container matColumnDef="albumTitle">
        <th mat-header-cell *matHeaderCellDef class="sticky-header"> Album Title </th>
        <td mat-cell *matCellDef="let photo"> {{ photo.album.title }} </td>
      </ng-container>

      <ng-container matColumnDef="userEmail">
        <th mat-header-cell *matHeaderCellDef class="sticky-header"> User Email </th>
        <td mat-cell *matCellDef="let photo"> {{ photo.album.user.email }} </td>
      </ng-container>

      <ng-container matColumnDef="photo">
        <th mat-header-cell *matHeaderCellDef class="sticky-header"> Photo </th>
        <td mat-cell *matCellDef="let photo">
          <div class="photo-container">
            <div
              *ngIf="!photoLoadStates[photo.id]?.loaded"
              class="skeleton-loader"
              [ngClass]="{ 'loading-animation': !photoLoadStates[photo.id].failed }"
              style="width: 150px; height: 150px;">
              <span *ngIf="photoLoadStates[photo.id]?.failed" class="error-text">
                Failed to load
              </span>
            </div>
            <img
              [src]="photo.thumbnailUrl"
              alt="photo"
              class="photo-thumbnail"
              (load)="onPhotoLoad(photo.id)"
              (error)="onPhotoError(photo.id)"
              [ngClass]="{ 'hidden': !photoLoadStates[photo.id].loaded || photoLoadStates[photo.id].failed }">
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="sticky-header"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <mat-paginator
    [length]="totalPhotos"
    [pageSize]="pageSize"
    [pageIndex]="pageIndex"
    [pageSizeOptions]="[10, 100, 500]"
    (page)="onPageChange($event)">
  </mat-paginator>
</div>
